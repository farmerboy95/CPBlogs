
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://farmerboy95.github.io/CPBlogs/cp-algorithms/data-structures/trees/sqrt-tree/">
      
      
        <link rel="prev" href="../../fundamentals/sparse-table/">
      
      
        <link rel="next" href="../dsu/">
      
      
      <link rel="icon" href="../../../../assets/images/ico-cpblog.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.6">
    
    
      
        <title>Sqrt Tree - farmerboy's CP Blogs</title>
      
    
    
  
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
  <link rel="stylesheet" href="../../../../assets/stylesheets/extra.css">

    
  
      
    

    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-W9EFM7GCX7"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-W9EFM7GCX7",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-W9EFM7GCX7",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
   <link href="../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#sqrt-tree" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="farmerboy&#39;s CP Blogs" class="md-header__button md-logo" aria-label="farmerboy's CP Blogs" data-md-component="logo">
      
  <img src="../../../../assets/images/ico-cpblog.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            farmerboy's CP Blogs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Sqrt Tree
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/farmerboy95/CPBlogs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    farmerboy95/CPBlogs
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../.." class="md-tabs__link">
          
  
  Trang chủ

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../Codeforces/graph/dfs-tree/" class="md-tabs__link">
          
  
  Codeforces

        </a>
      </li>
    
  

    
  

      
        
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../algebra/binary-exponentiation/" class="md-tabs__link">
          
  
  cp-algorithms

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../Codechef/data-structures/disjoint-sparse-table/" class="md-tabs__link">
          
  
  Codechef

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../LeetCode/reservoir-sampling/" class="md-tabs__link">
          
  
  LeetCode

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../misc/complexity-analysis/asymptotic-notations/" class="md-tabs__link">
          
  
  Nguồn khác

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="farmerboy&#39;s CP Blogs" class="md-nav__button md-logo" aria-label="farmerboy's CP Blogs" data-md-component="logo">
      
  <img src="../../../../assets/images/ico-cpblog.png" alt="logo">

    </a>
    farmerboy's CP Blogs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/farmerboy95/CPBlogs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    farmerboy95/CPBlogs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Trang chủ
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Trang chủ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Giới thiệu
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../navigation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Các tài liệu
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Codeforces
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Codeforces
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Đồ thị
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Đồ thị
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Codeforces/graph/dfs-tree/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cây DFS và ứng dụng
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Xử lý bit
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Xử lý bit
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Codeforces/bit-manipulation/xor-basis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kĩ thuật Vector cơ sở cho các bài toán XOR
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Toán học
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Toán học
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Codeforces/math/floors-ceilings-inequalities/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Floor, ceiling và bất đẳng thức cho người mới học
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Codeforces/math/sums-and-expected-value/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tổng và Giá trị kỳ vọng
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Codeforces/math/inclusion-exclusion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nguyên tắc Bao hàm - Loại trừ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Codeforces/math/permutations-for-beginners/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hoán vị cho người mới bắt đầu
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Hashing
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Hashing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Codeforces/hashing/blowing-up-unordered-map/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Giải mã và chống hack cho unordered-map trong C++
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    C++
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            C++
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Codeforces/c%2B%2B/no-rand/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ngưng xài rand() - Tổng quan về các trình sinh số ngẫu nhiên trong C++
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Các thuật toán ngẫu nhiên và gần đúng
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            Các thuật toán ngẫu nhiên và gần đúng
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Codeforces/randomized-algorithms/hacking-randomized-solutions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Làm sao hack các solution ngẫu nhiên và cách ngăn chặn nó
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    cp-algorithms
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            cp-algorithms
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Đại số
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Đại số
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/binary-exponentiation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Luỹ thừa nhị phân
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Cấu trúc dữ liệu
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Cấu trúc dữ liệu
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_1" >
        
          
          <label class="md-nav__link" for="__nav_3_2_1" id="__nav_3_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Cơ bản
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_1">
            <span class="md-nav__icon md-icon"></span>
            Cơ bản
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fundamentals/min-stack-min-queue/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Minimum Stack / Minimum Queue
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fundamentals/sparse-table/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sparse Table
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2_2" id="__nav_3_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Cây
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2_2">
            <span class="md-nav__icon md-icon"></span>
            Cây
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Sqrt Tree
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Sqrt Tree
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#nguon" class="md-nav__link">
    <span class="md-ellipsis">
      Nguồn
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loi-tua" class="md-nav__link">
    <span class="md-ellipsis">
      Lời tựa
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mo-ta" class="md-nav__link">
    <span class="md-ellipsis">
      Mô tả
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Mô tả">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xay-dung-chia-can" class="md-nav__link">
    <span class="md-ellipsis">
      Xây dựng chia căn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tao-cay" class="md-nav__link">
    <span class="md-ellipsis">
      Tạo cây
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#toi-uu-o-phuc-tap-truy-van" class="md-nav__link">
    <span class="md-ellipsis">
      Tối ưu độ phức tạp truy vấn
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cap-nhat-gia-tri" class="md-nav__link">
    <span class="md-ellipsis">
      Cập nhật giá trị
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cập nhật giá trị">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cap-nhat-gia-tri-mot-phan-tu" class="md-nav__link">
    <span class="md-ellipsis">
      Cập nhật giá trị một phần tử
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cập nhật giá trị một phần tử">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cach-tiep-can-on-gian" class="md-nav__link">
    <span class="md-ellipsis">
      Cách tiếp cận đơn giản
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mot-sqrt-tree-trong-sqrt-tree" class="md-nav__link">
    <span class="md-ellipsis">
      Một sqrt tree trong sqrt tree
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cap-nhat-gia-tri-mot-oan" class="md-nav__link">
    <span class="md-ellipsis">
      Cập nhật giá trị một đoạn
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cập nhật giá trị một đoạn">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cach-1" class="md-nav__link">
    <span class="md-ellipsis">
      Cách 1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cach-2" class="md-nav__link">
    <span class="md-ellipsis">
      Cách 2
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cai-at" class="md-nav__link">
    <span class="md-ellipsis">
      Cài đặt
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#luyen-tap" class="md-nav__link">
    <span class="md-ellipsis">
      Luyện tập
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dsu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Disjoint Set Union
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Đồ thị
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Đồ thị
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_3_1" id="__nav_3_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Đường đi ngắn nhất một nguồn
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_1">
            <span class="md-nav__icon md-icon"></span>
            Đường đi ngắn nhất một nguồn
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../graph/sssp/01-bfs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    0-1 BFS
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Xử lý xâu
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Xử lý xâu
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_1" >
        
          
          <label class="md-nav__link" for="__nav_3_4_1" id="__nav_3_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Các bài toán tiêu biểu
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_1">
            <span class="md-nav__icon md-icon"></span>
            Các bài toán tiêu biểu
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../string-processing/tasks/expression-parsing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Phân tích biểu thức
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Khác
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Khác
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5_1" >
        
          
          <label class="md-nav__link" for="__nav_3_5_1" id="__nav_3_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Khác
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5_1">
            <span class="md-nav__icon md-icon"></span>
            Khác
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../misc/misc/tortoise-and-hare/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Thuật toán Floyd tìm chu trình trong Linked List
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Codechef
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Codechef
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Cấu trúc dữ liệu
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Cấu trúc dữ liệu
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Codechef/data-structures/disjoint-sparse-table/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Disjoint Sparse Table
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    LeetCode
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            LeetCode
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/reservoir-sampling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lấy mẫu hồ chứa (Reservoir Sampling)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/search-in-rotated-sorted-array/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tìm kiếm trên mảng đã sắp xếp nhưng đã xoay
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/basic-calculator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tính toán biểu thức từ xâu
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/two-sum/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lớp bài tập Two-Sum
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Nguồn khác
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Nguồn khác
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" >
        
          
          <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Phân tích Độ phức tạp
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1">
            <span class="md-nav__icon md-icon"></span>
            Phân tích Độ phức tạp
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../misc/complexity-analysis/asymptotic-notations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Các ký hiệu tiệm cận
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../misc/complexity-analysis/potential-method/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Phương pháp Tiềm năng
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Cấu trúc dữ liệu
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            Cấu trúc dữ liệu
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../misc/data-structures/splay-tree/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Splay Tree: Một mình anh chấp hết
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" >
        
          
          <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Xác suất
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            Xác suất
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../misc/probability/probability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Xác suất
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../misc/probability/expected-value/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Giá trị kỳ vọng
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../misc/probability/linearity-of-expectation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kỳ vọng tuyến tính
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
        
          
          <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Kinh nghiệm
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            Kinh nghiệm
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../misc/experience/being-better/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Làm thế nào để giỏi hơn trong lập trình thi đấu?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../misc/experience/icpc-strategy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chiến thuật khi thi ICPC
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#nguon" class="md-nav__link">
    <span class="md-ellipsis">
      Nguồn
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loi-tua" class="md-nav__link">
    <span class="md-ellipsis">
      Lời tựa
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mo-ta" class="md-nav__link">
    <span class="md-ellipsis">
      Mô tả
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Mô tả">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xay-dung-chia-can" class="md-nav__link">
    <span class="md-ellipsis">
      Xây dựng chia căn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tao-cay" class="md-nav__link">
    <span class="md-ellipsis">
      Tạo cây
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#toi-uu-o-phuc-tap-truy-van" class="md-nav__link">
    <span class="md-ellipsis">
      Tối ưu độ phức tạp truy vấn
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cap-nhat-gia-tri" class="md-nav__link">
    <span class="md-ellipsis">
      Cập nhật giá trị
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cập nhật giá trị">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cap-nhat-gia-tri-mot-phan-tu" class="md-nav__link">
    <span class="md-ellipsis">
      Cập nhật giá trị một phần tử
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cập nhật giá trị một phần tử">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cach-tiep-can-on-gian" class="md-nav__link">
    <span class="md-ellipsis">
      Cách tiếp cận đơn giản
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mot-sqrt-tree-trong-sqrt-tree" class="md-nav__link">
    <span class="md-ellipsis">
      Một sqrt tree trong sqrt tree
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cap-nhat-gia-tri-mot-oan" class="md-nav__link">
    <span class="md-ellipsis">
      Cập nhật giá trị một đoạn
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cập nhật giá trị một đoạn">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cach-1" class="md-nav__link">
    <span class="md-ellipsis">
      Cách 1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cach-2" class="md-nav__link">
    <span class="md-ellipsis">
      Cách 2
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cai-at" class="md-nav__link">
    <span class="md-ellipsis">
      Cài đặt
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#luyen-tap" class="md-nav__link">
    <span class="md-ellipsis">
      Luyện tập
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
  
                  

  
  


<h1 id="sqrt-tree">Sqrt Tree</h1>
<h2 id="nguon">Nguồn</h2>
<p><a class="glightbox" href="../../../../assets/images/cpalgorithms.ico" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img src="../../../../assets/images/cpalgorithms.ico" width="16" height="16"/></a> <a href="https://cp-algorithms.com/data-structures/sqrt-tree.html">Sqrt Tree</a></p>
<h2 id="loi-tua">Lời tựa</h2>
<p>Cho một mảng <span class="arithmatex">\(a\)</span> có <span class="arithmatex">\(n\)</span> phần tử và toán tử <span class="arithmatex">\(\circ\)</span> thoả mãn tính chất kết hợp: <span class="arithmatex">\((x \circ y) \circ z = x \circ (y \circ z)\)</span> đúng với mọi <span class="arithmatex">\(x\)</span>, <span class="arithmatex">\(y\)</span>, <span class="arithmatex">\(z\)</span>.</p>
<p>Cho nên, các toán tử như <span class="arithmatex">\(gcd\)</span>, <span class="arithmatex">\(min\)</span>, <span class="arithmatex">\(max\)</span>, <span class="arithmatex">\(+\)</span>, <span class="arithmatex">\(and\)</span>, <span class="arithmatex">\(or\)</span>, <span class="arithmatex">\(xor\)</span>, <span class="arithmatex">\(\ldots\)</span> đều thoả tính chất kết hợp.</p>
<p>Ta cũng được cho thêm các truy vấn dạng <span class="arithmatex">\(q(l, r)\)</span>. Với mỗi truy vấn, ta cần tính <span class="arithmatex">\(a_l \circ a_{l+1} \circ \dots \circ a_r\)</span></p>
<p>Sqrt Tree có thể xử lý những truy vấn như vậy trong <span class="arithmatex">\(O(1)\)</span> thời gian với <span class="arithmatex">\(O(n \cdot \log \log n)\)</span> thời gian tiền xử lý và <span class="arithmatex">\(O(n \cdot \log \log n)\)</span> bộ nhớ.</p>
<h2 id="mo-ta">Mô tả</h2>
<h3 id="xay-dung-chia-can">Xây dựng chia căn</h3>
<p>Ta <a href="">chia căn</a> cho mảng. Chia mảng ra thành <span class="arithmatex">\(\sqrt{n}\)</span> block, mỗi block có kích thước <span class="arithmatex">\(\sqrt{n}\)</span>. Với mỗi block, ta tính:</p>
<ol>
<li>Trả lời các truy vấn nằm trong block đó, với <span class="arithmatex">\(l\)</span> là phần tử đầu tiên của block (lưu vào <span class="arithmatex">\(\text{prefixOp}\)</span>).</li>
<li>Trả lời các truy vấn nằm trong block đó, với <span class="arithmatex">\(r\)</span> là phần tử cuối cùng của block (lưu vào <span class="arithmatex">\(\text{suffixOp}\)</span>).</li>
</ol>
<p>Ta tính thêm một mảng nữa</p>
<ol>
<li><span class="arithmatex">\(between_{i,j}\)</span> (với <span class="arithmatex">\(i \leq j\)</span>) - trả lời truy vấn bắt đầu ở phần tử đầu tiên của block thứ <span class="arithmatex">\(i\)</span> và kết thúc ở phần tử cuối cùng của block <span class="arithmatex">\(j\)</span>. Lưu ý rằng ta có <span class="arithmatex">\(\sqrt{n}\)</span> block, nên kích thước mảng này sẽ là <span class="arithmatex">\(O(\sqrt{n}^2) = O(n)\)</span>.</li>
</ol>
<p>Xét ví dụ sau.</p>
<p>Cho <span class="arithmatex">\(\circ\)</span> là phép <span class="arithmatex">\(+\)</span> (ta tính tổng một đoạn) và có mảng <span class="arithmatex">\(a\)</span> như sau:</p>
<p><code>{1, 2, 3, 4, 5, 6, 7, 8, 9}</code></p>
<p>Nó sẽ được chia làm ba block: <code>{1, 2, 3}</code>, <code>{4, 5, 6}</code>, và <code>{7, 8, 9}</code>.</p>
<p>Trong block thứ nhất, <span class="arithmatex">\(\text{prefixOp}\)</span> là <code>{1, 3, 6}</code> và <span class="arithmatex">\(\text{suffixOp}\)</span> là <code>{6, 5, 3}</code>.</p>
<p>Trong block thứ hai, <span class="arithmatex">\(\text{prefixOp}\)</span> là <code>{4, 9, 15}</code> và <span class="arithmatex">\(\text{suffixOp}\)</span> là <code>{15, 11, 6}</code>.</p>
<p>Trong block thứ ba, <span class="arithmatex">\(\text{prefixOp}\)</span> là <code>{7, 15, 24}</code> và <span class="arithmatex">\(\text{suffixOp}\)</span> là <code>{24, 17, 9}</code>.</p>
<p>Mảng <span class="arithmatex">\(\text{between}\)</span> là:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>{
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    {6, 21, 45},
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    {0, 15, 39},
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    {0, 0,  24}
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>}
</code></pre></div>
<p>(ở đây ta giả sử nếu <span class="arithmatex">\(i &gt; j\)</span> thì <span class="arithmatex">\(between_{i,j}\)</span> là <span class="arithmatex">\(0\)</span>)</p>
<p>Ta đã có thể trả lời một số truy vấn với những mảng này. Nếu truy vấn không nằm gọn trong một block, ta có thể chia nó thành ba phần: hậu tố của một block, sau đó là một số đoạn của các block kề nhau và cuối cùng là tiền tố của một block. Ta có thể trả lời truy vấn bằng cách chia nó ra thành ba phần như trên rồi lấy một giá trị từ <span class="arithmatex">\(\text{suffixOp}\)</span>, sau đó đến một số giá trị từ <span class="arithmatex">\(\text{between}\)</span>, cuối cùng là một giá trị từ <span class="arithmatex">\(\text{prefixOp}\)</span>.</p>
<p>Nhưng nếu truy vấn nằm gọn trong một block, ta không thể làm như thế được. Vì vậy ta cần phải làm một cái gì đó ở đây.</p>
<h3 id="tao-cay">Tạo cây</h3>
<p>Ta không thể trả lời các truy vấn nằm gọn trong một block. Nhưng sẽ ra sao <strong>nếu ta tạo một cấu trúc dữ liệu y như trên cho mỗi block</strong>? Ta có thể làm được điều đó, và ta làm một cách đệ quy, cho đến khi kích thước block là <span class="arithmatex">\(1\)</span> hoặc <span class="arithmatex">\(2\)</span>. Trả lời các truy vấn cho các block nhỏ như vậy chỉ tốn <span class="arithmatex">\(O(1)\)</span>.</p>
<p>Vậy ta có một cái cây. Mỗi node trên cây quản lý một đoạn của mảng. Node quản lý đoạn kích thước bằng <span class="arithmatex">\(k\)</span> sẽ có <span class="arithmatex">\(\sqrt{k}\)</span> node con -- cho mỗi block. Thêm nữa, mỗi node chứa ba mảng <span class="arithmatex">\(\text{prefixOp}\)</span>, <span class="arithmatex">\(\text{suffixOp}\)</span> và <span class="arithmatex">\(\text{between}\)</span> như trên cho đoạn mà nó quản lý. Gốc của cây quản lý toàn bộ mảng. Node của các đoạn có độ dài <span class="arithmatex">\(1\)</span> hoặc <span class="arithmatex">\(2\)</span> là các node lá.</p>
<p>Rõ ràng là cây sẽ có chiều cao là <span class="arithmatex">\(O(\log \log n)\)</span>, vì nếu một node nào đó quản lý đoạn có độ dài là <span class="arithmatex">\(k\)</span>, thì các node con của nó là <span class="arithmatex">\(\sqrt{k}\)</span>. Ta có <span class="arithmatex">\(\log(\sqrt{k}) = \frac{\log{k}}{2}\)</span>, nên <span class="arithmatex">\(\log k\)</span> giảm hai lần qua mỗi lớp của cây, nên chiều cao cây là <span class="arithmatex">\(O(\log \log n)\)</span>. Thời gian và bộ nhớ cần dùng để xây dựng cây là <span class="arithmatex">\(O(n \cdot \log \log n)\)</span>, bởi vì mỗi phần tử trong mảng xuất hiện đúng một lần trên mỗi lớp của cây.</p>
<p>Giờ ta có thể trả lời các truy vấn trong <span class="arithmatex">\(O(\log \log n)\)</span>. Ta có thể đi xuống các node cho đến khi ta gặp đoạn độ dài <span class="arithmatex">\(1\)</span> hoặc <span class="arithmatex">\(2\)</span> (trả lời các truy vấn cho đoạn này có thể thực hiện trong <span class="arithmatex">\(O(1)\)</span>), hoặc đến khi gặp đoạn đầu tiên làm cho truy vấn không nằm trong một block. Xem phần trước để trả lời các truy vấn trong trường hợp này.</p>
<p>OK, <span class="arithmatex">\(O(\log \log n)\)</span> cũng nhanh đấy. Nhưng ta có thể làm nhanh hơn được không?</p>
<h3 id="toi-uu-o-phuc-tap-truy-van">Tối ưu độ phức tạp truy vấn</h3>
<p>Một trong những việc tối ưu rõ ràng nhất ở đây chính là việc tìm kiếm nhị phân node ta cần. Với tìm kiếm nhị phân, ta có thể truy vấn trong <span class="arithmatex">\(O(\log \log \log n)\)</span>. Nhưng có thể nhanh hơn nữa không?</p>
<p>Câu trả lời là có. Giả sử ta có những điều sau:</p>
<ol>
<li>Các kích thước block là luỹ thừa của <span class="arithmatex">\(2\)</span>.</li>
<li>Tất cả các block có kích thước bằng nhau ở mỗi lớp.</li>
</ol>
<p>Để làm được điều này, ta cần thêm các phần tử <span class="arithmatex">\(0\)</span> vào mảng sao cho kích thước của nó là một luỹ thừa của <span class="arithmatex">\(2\)</span>.</p>
<p>Khi làm như vậy, kích thước block có thể tăng gấp đôi để trở thành một luỹ thừa của <span class="arithmatex">\(2\)</span>, nhưng nó vẫn sẽ là <span class="arithmatex">\(O(\sqrt{k})\)</span> và ta giữ độ phức tạp tuyến tính khi tạo các mảng thành phần trong đoạn.</p>
<p>Giờ ta có thể dễ dàng kiểm tra xem truy vấn có nằm hẳn trong block có kích thước <span class="arithmatex">\(2^k\)</span> hay không. Viết <span class="arithmatex">\(l\)</span> và <span class="arithmatex">\(r\)</span> theo hệ nhị phân (ta đánh số vị trí từ <span class="arithmatex">\(0\)</span>). Ví dụ, cho <span class="arithmatex">\(k=4, l=39, r=46\)</span>. Biểu diễn nhị phân của <span class="arithmatex">\(l\)</span> và <span class="arithmatex">\(r\)</span> là:</p>
<div class="arithmatex">\[l = 39_{10} = 100111_2\]</div>
<div class="arithmatex">\[r = 46_{10} = 101110_2\]</div>
<p>Nhớ lại rằng một lớp gồm các đoạn có kích thước bằng nhau, và các block trên một lớp cũng có kích thước bằng nhau (trong trường hợp này kích thước là <span class="arithmatex">\(2^k = 2^4 = 16\)</span>). Các block bao phủ toàn bộ mảng, nên block đầu tiên quản lý các phần tử <span class="arithmatex">\((0 - 15)\)</span> (<span class="arithmatex">\((000000_2 - 001111_2)\)</span> theo hệ nhị phân), block thứ hai quản lý các phần tử <span class="arithmatex">\((16 - 31)\)</span> (<span class="arithmatex">\((010000_2 - 011111_2)\)</span> theo hệ nhị phân) và cứ như thế. Ta thấy rằng các chỉ số vị trí trong một block chỉ khác nhau ở <span class="arithmatex">\(k\)</span> bit nhỏ nhất (trong trường hợp này là <span class="arithmatex">\(4\)</span>). Nếu <span class="arithmatex">\(l\)</span> và <span class="arithmatex">\(r\)</span> có các bit bằng nhau, trừ <span class="arithmatex">\(4\)</span> bit nhỏ nhất, đoạn này sẽ nằm trong một block.</p>
<p>Vậy, ta chỉ cần kiểm tra <span class="arithmatex">\(k\)</span> bit nhỏ nhất của hai số có khác nhau hay không (hay nói cách khác là <span class="arithmatex">\(l\ \text{xor}\ r\)</span> có vượt quá <span class="arithmatex">\(2^k-1\)</span> hay không).</p>
<p>Với observation này, ta có thể tìm ra được lớp thích hợp để trả lời truy vấn rất nhanh như sau:</p>
<ol>
<li>Với mỗi <span class="arithmatex">\(i\)</span> không vượt quá kích thước mảng, ta tìm bit <span class="arithmatex">\(1\)</span> lớn nhất. Để làm được thì ta dùng DP và một mảng tiền xử lý.</li>
<li>Với mỗi truy vấn <span class="arithmatex">\(q(l,r)\)</span>, ta tìm bit <span class="arithmatex">\(1\)</span> lớn nhất của <span class="arithmatex">\(l\ \text{xor}\ r\)</span> và dùng thông tin này để chọn lớp trên sqrt tree để xử lý truy vấn. Ta cũng có thể dùng mảng tiền xử lý ở đây.</li>
</ol>
<p>Có thể đọc code ở dưới cùng của bài viết để hiểu thêm.</p>
<p>Do vậy, bằng cách này, ta có thể trả lời truy vấn trong <span class="arithmatex">\(O(1)\)</span>.</p>
<h2 id="cap-nhat-gia-tri">Cập nhật giá trị</h2>
<p>Ta cũng có thể cập nhật các phần tử trên Sqrt Tree. Cập nhật một phần tử hoặc một đoạn đều được.</p>
<h3 id="cap-nhat-gia-tri-mot-phan-tu">Cập nhật giá trị một phần tử</h3>
<p>Xét một truy vấn <span class="arithmatex">\(\text{update}(x, val)\)</span> thực hiện phép gán <span class="arithmatex">\(a_x = val\)</span>. Ta cần thực hiện truy vấn này đủ nhanh.</p>
<h4 id="cach-tiep-can-on-gian">Cách tiếp cận đơn giản</h4>
<p>Đầu tiên, ta xét xem những gì sẽ xảy ra trên cây khi một phần tử nào đó thay đổi giá trị. Xét một node trên cây quản lý đoạn độ dài <span class="arithmatex">\(l\)</span> và những mảng thành phần của nó: <span class="arithmatex">\(\text{prefixOp}\)</span>, <span class="arithmatex">\(\text{suffixOp}\)</span> và <span class="arithmatex">\(\text{between}\)</span>. Dễ thấy rằng chỉ có <span class="arithmatex">\(O(\sqrt{l})\)</span> phần tử trong <span class="arithmatex">\(\text{prefixOp}\)</span> và <span class="arithmatex">\(\text{suffixOp}\)</span> là thay đổi (trong block chứa phần tử bị thay đổi). <span class="arithmatex">\(O(l)\)</span> phần tử thay đổi trong mảng <span class="arithmatex">\(\text{between}\)</span>. Suy ra rằng <span class="arithmatex">\(O(l)\)</span> phần tử trên cây thay đổi.</p>
<p>Nhớ rằng bất cứ phần tử <span class="arithmatex">\(x\)</span> nào sẽ hiện diện trên một node trên cây trên mỗi lớp. Node gốc (lớp <span class="arithmatex">\(0\)</span>) có độ dài <span class="arithmatex">\(O(n)\)</span>, các node trên lớp <span class="arithmatex">\(1\)</span> có độ dài <span class="arithmatex">\(O(\sqrt{n})\)</span>, các node trên lớp <span class="arithmatex">\(2\)</span> có độ dài <span class="arithmatex">\(O(\sqrt{\sqrt{n}})\)</span>, v.v... Vậy độ phức tạp thời gian trên mỗi lần cập nhật là <span class="arithmatex">\(O(n + \sqrt{n} + \sqrt{\sqrt{n}} + \dots) = O(n)\)</span>.</p>
<p>Nhưng như vậy là quá chậm. Có thể làm nhanh hơn không?</p>
<h4 id="mot-sqrt-tree-trong-sqrt-tree">Một sqrt tree trong sqrt tree</h4>
<p>Lưu ý rằng nút thắt ở đây là việc cập nhật lại mảng <span class="arithmatex">\(\text{between}\)</span> của node gốc quá mất thời gian. Để tối ưu cây, ta bỏ cái mảng này luôn. Thay vì dùng mảng <span class="arithmatex">\(\text{between}\)</span>, ta lưu một sqrt tree nữa cho node gốc. Gọi nó là <span class="arithmatex">\(\text{index}\)</span>. Nó đóng vai trò y như <span class="arithmatex">\(\text{between}\)</span> - trả lời các truy vấn trên dãy các block. Chú ý rằng các node còn lại trên cây không có <span class="arithmatex">\(\text{index}\)</span>, chúng vẫn dùng mảng <span class="arithmatex">\(\text{between}\)</span>.</p>
<p>Một sqrt tree được xem là <em>indexed</em>, nếu node gốc có <span class="arithmatex">\(\text{index}\)</span>. Một sqrt tree với mảng <span class="arithmatex">\(\text{between}\)</span> trong node gốc được gọi là <em>unindexed</em>. Lưu ý rằng cây <span class="arithmatex">\(\text{index}\)</span> <strong>thì <em>unindexed</em></strong>.</p>
<p>Vậy ta có thuật toán sau để cập nhật trên cây đã được <em>indexed</em>:</p>
<ul>
<li>Cập nhật <span class="arithmatex">\(\text{prefixOp}\)</span> và <span class="arithmatex">\(\text{suffixOp}\)</span> trong <span class="arithmatex">\(O(\sqrt{n})\)</span>.</li>
<li>Cập nhật <span class="arithmatex">\(\text{index}\)</span>. Nó có độ dài <span class="arithmatex">\(O(\sqrt{n})\)</span> và ta chỉ cần cập nhật một giá trị trong đó thôi (giá trị đi theo block đã thay đổi). Vậy độ phức tạp thời gian của bước này là <span class="arithmatex">\(O(\sqrt{n})\)</span>. Ta có thể dùng thuật toán được mô tả ở đầu phần này (thuật toán "chậm") để làm.</li>
<li>Đi đến node con biểu diễn block được thay đổi và cập nhật nó trong <span class="arithmatex">\(O(\sqrt{n})\)</span> với thuật toán "chậm".</li>
</ul>
<p>Lưu ý rằng độ phức tạp của việc truy vấn vẫn là <span class="arithmatex">\(O(1)\)</span>: ta cần dùng <span class="arithmatex">\(\text{index}\)</span> trong truy vấn đúng một lần, và sẽ tốn <span class="arithmatex">\(O(1)\)</span> thời gian.</p>
<p>Vậy tổng độ phức tạp thời gian cho việc cập nhật một phần tử là <span class="arithmatex">\(O(\sqrt{n})\)</span>.</p>
<h3 id="cap-nhat-gia-tri-mot-oan">Cập nhật giá trị một đoạn</h3>
<p>Sqrt tree cũng có thể gán tất cả các giá trị của một đoạn bằng một giá trị nào đó. Gọi hàm <span class="arithmatex">\(\text{massUpdate}(x, l, r)\)</span> nghĩa là <span class="arithmatex">\(a_i = x\)</span> với mọi <span class="arithmatex">\(l \le i \le r\)</span>.</p>
<p>Có hai cách tiếp cận để giải quyết vấn đề này: một trong số đó chạy <span class="arithmatex">\(\text{massUpdate}\)</span> trong <span class="arithmatex">\(O(\sqrt{n}\cdot \log \log n)\)</span>, với truy vấn trong <span class="arithmatex">\(O(1)\)</span>. Cách thứ hai thì chạy <span class="arithmatex">\(\text{massUpdate}\)</span> trong <span class="arithmatex">\(O(\sqrt{n})\)</span>, nhưng lại truy vấn trong <span class="arithmatex">\(O(\log \log n)\)</span>.</p>
<p>Ta sẽ cập nhật lazy y như cách làm với segment tree: đánh dấu một số node là <em>lazy</em>, nghĩa là ta sẽ đẩy cập nhật xuống chỉ khi cần thiết. Nhưng điểm khác so với segment tree là: đẩy cập nhật rất tốn tài nguyên, nên sẽ không làm được trong các truy vấn. Trên lớp <span class="arithmatex">\(0\)</span>, đẩy cập nhật tốn <span class="arithmatex">\(O(\sqrt{n})\)</span> thời gian. Vì thế nên ta không đẩy trong truy vấn, ta chỉ xem nếu node hiện tại hoặc cha của node đó <em>lazy</em>, và chỉ xét nó khi chạy truy vấn.</p>
<h4 id="cach-1">Cách 1</h4>
<p>Ta giả sử rằng chỉ có các node trên lớp <span class="arithmatex">\(1\)</span> (với độ dài <span class="arithmatex">\(O(\sqrt{n})\)</span>) là có thể <em>lazy</em>. Khi đẩy node xuống, nó cập nhật tất cả cây con kể cả nó trong <span class="arithmatex">\(O(\sqrt{n}\cdot \log \log n)\)</span>. Quá trình <span class="arithmatex">\(\text{massUpdate}\)</span> sẽ như sau:</p>
<ul>
<li>Xét các node trên lớp <span class="arithmatex">\(1\)</span> và các block tương ứng với chúng.</li>
<li>Một số block được bao phủ hoàn toàn bởi <span class="arithmatex">\(\text{massUpdate}\)</span>. Ta đánh dấu chúng là <em>lazy</em> trong <span class="arithmatex">\(O(\sqrt{n})\)</span>.</li>
<li>Một số block được bao phủ một phần. Lưu ý rằng không có nhiều hơn hai block như vậy. Xây dựng lại chúng trong <span class="arithmatex">\(O(\sqrt{n}\cdot \log \log n)\)</span>. Nếu chúng <em>lazy</em>, tranh thủ xét chúng.</li>
<li>Cập nhật <span class="arithmatex">\(\text{prefixOp}\)</span> và <span class="arithmatex">\(\text{suffixOp}\)</span> cho các block bị bao phủ một phần trong <span class="arithmatex">\(O(\sqrt{n})\)</span> (vì chỉ có hai block như vậy).</li>
<li>Xây dựng lại <span class="arithmatex">\(\text{index}\)</span> trong <span class="arithmatex">\(O(\sqrt{n}\cdot \log \log n)\)</span>.</li>
</ul>
<p>Ta có thể thực hiện <span class="arithmatex">\(\text{massUpdate}\)</span> nhanh chóng. Nhưng cập nhật <em>lazy</em> thì ảnh hưởng gì đến truy vấn? Nó sẽ tạo ra các thay đổi sau:</p>
<ul>
<li>Nếu truy vấn nằm hoàn toàn trong một <em>lazy</em> block, tính kết quả và xét cả <em>lazy</em>, <span class="arithmatex">\(O(1)\)</span>.</li>
<li>Nếu truy vấn gồm nhiều block, một số trong đó <em>lazy</em>, ta cần quan tâm <em>lazy</em> nằm bên trái hoặc phải ngoài cùng. Các block còn lại được tính bằng <span class="arithmatex">\(\text{index}\)</span>, ta đã biết được kết quả trên các block <em>lazy</em> rồi (vì <span class="arithmatex">\(\text{index}\)</span> được xây dựng lại mỗi khi có thay đổi ở mảng), <span class="arithmatex">\(O(1)\)</span>.</li>
</ul>
<p>Độ phức tạp của truy vấn vẫn là <span class="arithmatex">\(O(1)\)</span>.</p>
<h4 id="cach-2">Cách 2</h4>
<p>Ở cách tiếp cận này, mỗi node đều có thể <em>lazy</em> (trừ node gốc). Kể cả các node trong <span class="arithmatex">\(\text{index}\)</span> cũng có thể <em>lazy</em>. Vì thế nên khi ta thực hiện một truy vấn, ta cần phải xem thử các biến <em>lazy</em> trên các node tổ tiên, nghĩa là độ phức tạp truy vấn sẽ là <span class="arithmatex">\(O(\log \log n)\)</span>.</p>
<p>Nhưng <span class="arithmatex">\(\text{massUpdate}\)</span> lại nhanh hơn. Nó sẽ trông như sau:</p>
<ul>
<li>Một số block được bao phủ hoàn toàn bởi  <span class="arithmatex">\(\text{massUpdate}\)</span> nên <em>lazy</em> được thêm vào chúng, độ phức tạp  <span class="arithmatex">\(O(\sqrt{n})\)</span>.</li>
<li>Cập nhật <span class="arithmatex">\(\text{prefixOp}\)</span>  và <span class="arithmatex">\(\text{suffixOp}\)</span> cho các block được phủ một phần trong <span class="arithmatex">\(O(\sqrt{n})\)</span> (vì chỉ có hai block như vậy thôi).</li>
<li>Đừng quên cập nhật <span class="arithmatex">\(\text{index}\)</span>. Nó tốn <span class="arithmatex">\(O(\sqrt{n})\)</span> (cũng dùng thuật  <span class="arithmatex">\(\text{massUpdate}\)</span>  như vậy).</li>
<li>Cập nhật mảng <span class="arithmatex">\(\text{between}\)</span>  cho các cây con <em>unindexed</em>.</li>
<li>Đi vào các node được bao phủ một phần và tiếp tục gọi <span class="arithmatex">\(\text{massUpdate}\)</span> như thế.</li>
</ul>
<p>Lưu ý rằng khi gọi đệ quy, ta <span class="arithmatex">\(\text{massUpdate}\)</span> tiền tố hoặc hậu tố. Nhưng với việc cập nhật tiền tố và hậu tố, ta chỉ có thể có một node con được bao phủ một phần thôi. Nên ta thăm một node trên lớp <span class="arithmatex">\(1\)</span>, hai node trên lớp <span class="arithmatex">\(2\)</span> và hai node trên bất cứ lớp tiếp theo nào. Nên độ phức tạp thời gian là <span class="arithmatex">\(O(\sqrt{n} + \sqrt{\sqrt{n}} + \dots) = O(\sqrt{n})\)</span>. Cách tiếp cận này tương tự với mass update trên segment tree.</p>
<h2 id="cai-at">Cài đặt</h2>
<p>Code sau đây của Sqrt Tree có thể thực hiện các thao tác sau: xây dựng xây trong <span class="arithmatex">\(O(n \cdot \log \log n)\)</span>, trả lời truy vấn trong <span class="arithmatex">\(O(1)\)</span>, cập nhật một phần tử trong <span class="arithmatex">\(O(\sqrt{n})\)</span>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">SqrtTreeItem</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">    </span><span class="c1">// tạo item theo ý thích của bạn</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="p">};</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="c1">// nhớ thêm thao tác vào</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="n">SqrtTreeItem</span><span class="w"> </span><span class="nf">op</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">SqrtTreeItem</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">SqrtTreeItem</span><span class="w"> </span><span class="o">&amp;</span><span class="n">b</span><span class="p">);</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="kr">inline</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">log2Up</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">        </span><span class="n">res</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="p">}</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="k">struct</span><span class="w"> </span><span class="nc">SqrtTree</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">lg</span><span class="p">,</span><span class="w"> </span><span class="n">indexSz</span><span class="p">;</span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="w">    </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">SqrtTreeItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">v</span><span class="p">;</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="w">    </span><span class="n">vi</span><span class="w"> </span><span class="n">clz</span><span class="p">,</span><span class="w"> </span><span class="n">layers</span><span class="p">,</span><span class="w"> </span><span class="n">onLayer</span><span class="p">;</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="w">    </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">SqrtTreeItem</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">pref</span><span class="p">,</span><span class="w"> </span><span class="n">suf</span><span class="p">,</span><span class="w"> </span><span class="n">between</span><span class="p">;</span>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="w">    </span><span class="kr">inline</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">buildBlock</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">layer</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="w">        </span><span class="c1">// block [l, r)</span>
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="w">        </span><span class="c1">// tính các mảng prefix và suffix</span>
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a><span class="w">        </span><span class="n">pref</span><span class="p">[</span><span class="n">layer</span><span class="p">][</span><span class="n">l</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">[</span><span class="n">l</span><span class="p">];</span>
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="w">        </span><span class="n">FOR</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="w">            </span><span class="n">pref</span><span class="p">[</span><span class="n">layer</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">op</span><span class="p">(</span><span class="n">pref</span><span class="p">[</span><span class="n">layer</span><span class="p">][</span><span class="n">i</span><span class="mi">-1</span><span class="p">],</span><span class="w"> </span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a><span class="w">        </span><span class="n">suf</span><span class="p">[</span><span class="n">layer</span><span class="p">][</span><span class="n">r</span><span class="mi">-1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">[</span><span class="n">r</span><span class="mi">-1</span><span class="p">];</span>
<a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a><span class="w">        </span><span class="n">FORE</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">r</span><span class="mi">-2</span><span class="p">,</span><span class="n">l</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a><span class="w">            </span><span class="n">suf</span><span class="p">[</span><span class="n">layer</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">op</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">suf</span><span class="p">[</span><span class="n">layer</span><span class="p">][</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>
<a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a>
<a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a><span class="w">    </span><span class="kr">inline</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">buildBetween</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">layer</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">lBound</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">rBound</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">betweenOffs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a><span class="w">        </span><span class="c1">// log của block size</span>
<a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">bSzLog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">layers</span><span class="p">[</span><span class="n">layer</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a><span class="w">        </span><span class="c1">// log of số các block</span>
<a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">bCntLog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">layers</span><span class="p">[</span><span class="n">layer</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a><span class="w">        </span><span class="c1">// block size</span>
<a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">bSz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">bSzLog</span><span class="p">;</span>
<a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a><span class="w">        </span><span class="c1">// số các block của layer này, đơn giản nó là ceilDiv(r - l, bSz)</span>
<a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">bCnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">rBound</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lBound</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">bSz</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">bSzLog</span><span class="p">;</span>
<a id="__codelineno-1-44" name="__codelineno-1-44" href="#__codelineno-1-44"></a>
<a id="__codelineno-1-45" name="__codelineno-1-45" href="#__codelineno-1-45"></a><span class="w">        </span><span class="c1">// build mảng &quot;between&quot;</span>
<a id="__codelineno-1-46" name="__codelineno-1-46" href="#__codelineno-1-46"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">bCnt</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-47" name="__codelineno-1-47" href="#__codelineno-1-47"></a><span class="w">            </span><span class="n">SqrtTreeItem</span><span class="w"> </span><span class="n">ans</span><span class="p">;</span>
<a id="__codelineno-1-48" name="__codelineno-1-48" href="#__codelineno-1-48"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">bCnt</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-49" name="__codelineno-1-49" href="#__codelineno-1-49"></a><span class="w">                </span><span class="n">SqrtTreeItem</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">suf</span><span class="p">[</span><span class="n">layer</span><span class="p">][</span><span class="n">lBound</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">bSzLog</span><span class="p">)];</span>
<a id="__codelineno-1-50" name="__codelineno-1-50" href="#__codelineno-1-50"></a><span class="w">                </span><span class="n">ans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">op</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span><span class="w"> </span><span class="n">add</span><span class="p">);</span>
<a id="__codelineno-1-51" name="__codelineno-1-51" href="#__codelineno-1-51"></a><span class="w">                </span><span class="c1">// between[i][j]</span>
<a id="__codelineno-1-52" name="__codelineno-1-52" href="#__codelineno-1-52"></a><span class="w">                </span><span class="n">between</span><span class="p">[</span><span class="n">layer</span><span class="mi">-1</span><span class="p">][</span><span class="n">betweenOffs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lBound</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">bCntLog</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ans</span><span class="p">;</span>
<a id="__codelineno-1-53" name="__codelineno-1-53" href="#__codelineno-1-53"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-1-54" name="__codelineno-1-54" href="#__codelineno-1-54"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-1-55" name="__codelineno-1-55" href="#__codelineno-1-55"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-56" name="__codelineno-1-56" href="#__codelineno-1-56"></a>
<a id="__codelineno-1-57" name="__codelineno-1-57" href="#__codelineno-1-57"></a><span class="w">    </span><span class="kr">inline</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">buildBetweenZero</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-58" name="__codelineno-1-58" href="#__codelineno-1-58"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">bSzLog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">lg</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-1-59" name="__codelineno-1-59" href="#__codelineno-1-59"></a><span class="w">        </span><span class="c1">// thêm giá trị của các block của layer 0 vào &quot;index&quot; của sqrt tree và build cây đó</span>
<a id="__codelineno-1-60" name="__codelineno-1-60" href="#__codelineno-1-60"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">indexSz</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-61" name="__codelineno-1-61" href="#__codelineno-1-61"></a><span class="w">            </span><span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">suf</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">bSzLog</span><span class="p">];</span>
<a id="__codelineno-1-62" name="__codelineno-1-62" href="#__codelineno-1-62"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-1-63" name="__codelineno-1-63" href="#__codelineno-1-63"></a><span class="w">        </span><span class="n">build</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">indexSz</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">lg</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">n</span><span class="p">);</span>
<a id="__codelineno-1-64" name="__codelineno-1-64" href="#__codelineno-1-64"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-65" name="__codelineno-1-65" href="#__codelineno-1-65"></a>
<a id="__codelineno-1-66" name="__codelineno-1-66" href="#__codelineno-1-66"></a><span class="w">    </span><span class="kr">inline</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateBetweenZero</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">bid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-67" name="__codelineno-1-67" href="#__codelineno-1-67"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">bSzLog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">lg</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-1-68" name="__codelineno-1-68" href="#__codelineno-1-68"></a><span class="w">        </span><span class="c1">// update block value của &quot;index&quot; sqrt tree</span>
<a id="__codelineno-1-69" name="__codelineno-1-69" href="#__codelineno-1-69"></a><span class="w">        </span><span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="n">bid</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">suf</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">bid</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">bSzLog</span><span class="p">];</span>
<a id="__codelineno-1-70" name="__codelineno-1-70" href="#__codelineno-1-70"></a><span class="w">        </span><span class="c1">// update &quot;index&quot; sqrt tree</span>
<a id="__codelineno-1-71" name="__codelineno-1-71" href="#__codelineno-1-71"></a><span class="w">        </span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">indexSz</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">lg</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">+</span><span class="n">bid</span><span class="p">);</span>
<a id="__codelineno-1-72" name="__codelineno-1-72" href="#__codelineno-1-72"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-73" name="__codelineno-1-73" href="#__codelineno-1-73"></a>
<a id="__codelineno-1-74" name="__codelineno-1-74" href="#__codelineno-1-74"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">layer</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">lBound</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">rBound</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">betweenOffset</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-75" name="__codelineno-1-75" href="#__codelineno-1-75"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">layer</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">SZ</span><span class="p">(</span><span class="n">layers</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-76" name="__codelineno-1-76" href="#__codelineno-1-76"></a><span class="w">            </span><span class="c1">// return khi layer index lớn hơn hoặc bằng số layer</span>
<a id="__codelineno-1-77" name="__codelineno-1-77" href="#__codelineno-1-77"></a><span class="w">            </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-1-78" name="__codelineno-1-78" href="#__codelineno-1-78"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-1-79" name="__codelineno-1-79" href="#__codelineno-1-79"></a>
<a id="__codelineno-1-80" name="__codelineno-1-80" href="#__codelineno-1-80"></a><span class="w">        </span><span class="c1">// block size</span>
<a id="__codelineno-1-81" name="__codelineno-1-81" href="#__codelineno-1-81"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">bSz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">((</span><span class="n">layers</span><span class="p">[</span><span class="n">layer</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-1-82" name="__codelineno-1-82" href="#__codelineno-1-82"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lBound</span><span class="p">;</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">rBound</span><span class="p">;</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">bSz</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-83" name="__codelineno-1-83" href="#__codelineno-1-83"></a><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">bSz</span><span class="p">,</span><span class="w"> </span><span class="n">rBound</span><span class="p">);</span>
<a id="__codelineno-1-84" name="__codelineno-1-84" href="#__codelineno-1-84"></a><span class="w">            </span><span class="n">buildBlock</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">);</span>
<a id="__codelineno-1-85" name="__codelineno-1-85" href="#__codelineno-1-85"></a><span class="w">            </span><span class="n">build</span><span class="p">(</span><span class="n">layer</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">betweenOffset</span><span class="p">);</span>
<a id="__codelineno-1-86" name="__codelineno-1-86" href="#__codelineno-1-86"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-1-87" name="__codelineno-1-87" href="#__codelineno-1-87"></a>
<a id="__codelineno-1-88" name="__codelineno-1-88" href="#__codelineno-1-88"></a><span class="w">        </span><span class="c1">// build &quot;index&quot; sqrt tree khi ở layer 0, ngược lại build &quot;between&quot;</span>
<a id="__codelineno-1-89" name="__codelineno-1-89" href="#__codelineno-1-89"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">layer</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-90" name="__codelineno-1-90" href="#__codelineno-1-90"></a><span class="w">            </span><span class="n">buildBetweenZero</span><span class="p">();</span>
<a id="__codelineno-1-91" name="__codelineno-1-91" href="#__codelineno-1-91"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-92" name="__codelineno-1-92" href="#__codelineno-1-92"></a><span class="w">            </span><span class="n">buildBetween</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span><span class="w"> </span><span class="n">lBound</span><span class="p">,</span><span class="w"> </span><span class="n">rBound</span><span class="p">,</span><span class="w"> </span><span class="n">betweenOffset</span><span class="p">);</span>
<a id="__codelineno-1-93" name="__codelineno-1-93" href="#__codelineno-1-93"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-1-94" name="__codelineno-1-94" href="#__codelineno-1-94"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-95" name="__codelineno-1-95" href="#__codelineno-1-95"></a>
<a id="__codelineno-1-96" name="__codelineno-1-96" href="#__codelineno-1-96"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">layer</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">lBound</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">rBound</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">betweenOffset</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-97" name="__codelineno-1-97" href="#__codelineno-1-97"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">layer</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">layers</span><span class="p">.</span><span class="n">size</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-98" name="__codelineno-1-98" href="#__codelineno-1-98"></a><span class="w">            </span><span class="c1">// return khi layer index lớn hơn hoặc bằng số layer</span>
<a id="__codelineno-1-99" name="__codelineno-1-99" href="#__codelineno-1-99"></a><span class="w">            </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-1-100" name="__codelineno-1-100" href="#__codelineno-1-100"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-1-101" name="__codelineno-1-101" href="#__codelineno-1-101"></a>
<a id="__codelineno-1-102" name="__codelineno-1-102" href="#__codelineno-1-102"></a><span class="w">        </span><span class="c1">// log của block size</span>
<a id="__codelineno-1-103" name="__codelineno-1-103" href="#__codelineno-1-103"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">bSzLog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">layers</span><span class="p">[</span><span class="n">layer</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-1-104" name="__codelineno-1-104" href="#__codelineno-1-104"></a><span class="w">        </span><span class="c1">// block size</span>
<a id="__codelineno-1-105" name="__codelineno-1-105" href="#__codelineno-1-105"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">bSz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">bSzLog</span><span class="p">;</span>
<a id="__codelineno-1-106" name="__codelineno-1-106" href="#__codelineno-1-106"></a><span class="w">        </span><span class="c1">// block index chứa x</span>
<a id="__codelineno-1-107" name="__codelineno-1-107" href="#__codelineno-1-107"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">blockIdx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lBound</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">bSzLog</span><span class="p">;</span>
<a id="__codelineno-1-108" name="__codelineno-1-108" href="#__codelineno-1-108"></a><span class="w">        </span><span class="c1">// [l, r) của block chứa x</span>
<a id="__codelineno-1-109" name="__codelineno-1-109" href="#__codelineno-1-109"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lBound</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">blockIdx</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">bSzLog</span><span class="p">);</span>
<a id="__codelineno-1-110" name="__codelineno-1-110" href="#__codelineno-1-110"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">bSz</span><span class="p">,</span><span class="w"> </span><span class="n">rBound</span><span class="p">);</span>
<a id="__codelineno-1-111" name="__codelineno-1-111" href="#__codelineno-1-111"></a><span class="w">        </span><span class="c1">// update mảng pref và suf</span>
<a id="__codelineno-1-112" name="__codelineno-1-112" href="#__codelineno-1-112"></a><span class="w">        </span><span class="n">buildBlock</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">);</span>
<a id="__codelineno-1-113" name="__codelineno-1-113" href="#__codelineno-1-113"></a>
<a id="__codelineno-1-114" name="__codelineno-1-114" href="#__codelineno-1-114"></a><span class="w">        </span><span class="c1">// build &quot;index&quot; sqrt tree khi ở layer 0, ngược lại build &quot;between&quot;</span>
<a id="__codelineno-1-115" name="__codelineno-1-115" href="#__codelineno-1-115"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">layer</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-116" name="__codelineno-1-116" href="#__codelineno-1-116"></a><span class="w">            </span><span class="n">updateBetweenZero</span><span class="p">(</span><span class="n">blockIdx</span><span class="p">);</span>
<a id="__codelineno-1-117" name="__codelineno-1-117" href="#__codelineno-1-117"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-118" name="__codelineno-1-118" href="#__codelineno-1-118"></a><span class="w">            </span><span class="n">buildBetween</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span><span class="w"> </span><span class="n">lBound</span><span class="p">,</span><span class="w"> </span><span class="n">rBound</span><span class="p">,</span><span class="w"> </span><span class="n">betweenOffset</span><span class="p">);</span>
<a id="__codelineno-1-119" name="__codelineno-1-119" href="#__codelineno-1-119"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-1-120" name="__codelineno-1-120" href="#__codelineno-1-120"></a><span class="w">        </span><span class="c1">// update cho đến nút lá</span>
<a id="__codelineno-1-121" name="__codelineno-1-121" href="#__codelineno-1-121"></a><span class="w">        </span><span class="n">update</span><span class="p">(</span><span class="n">layer</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">betweenOffset</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-1-122" name="__codelineno-1-122" href="#__codelineno-1-122"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-123" name="__codelineno-1-123" href="#__codelineno-1-123"></a>
<a id="__codelineno-1-124" name="__codelineno-1-124" href="#__codelineno-1-124"></a><span class="w">    </span><span class="kr">inline</span><span class="w"> </span><span class="n">SqrtTreeItem</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">betweenOffset</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">base</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-125" name="__codelineno-1-125" href="#__codelineno-1-125"></a><span class="w">        </span><span class="c1">// đoạn [l, r]</span>
<a id="__codelineno-1-126" name="__codelineno-1-126" href="#__codelineno-1-126"></a><span class="w">        </span><span class="c1">// độ dài 1</span>
<a id="__codelineno-1-127" name="__codelineno-1-127" href="#__codelineno-1-127"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-128" name="__codelineno-1-128" href="#__codelineno-1-128"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">v</span><span class="p">[</span><span class="n">l</span><span class="p">];</span>
<a id="__codelineno-1-129" name="__codelineno-1-129" href="#__codelineno-1-129"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-1-130" name="__codelineno-1-130" href="#__codelineno-1-130"></a><span class="w">        </span><span class="c1">// độ dài 2</span>
<a id="__codelineno-1-131" name="__codelineno-1-131" href="#__codelineno-1-131"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-132" name="__codelineno-1-132" href="#__codelineno-1-132"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">op</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">l</span><span class="p">],</span><span class="w"> </span><span class="n">v</span><span class="p">[</span><span class="n">r</span><span class="p">]);</span>
<a id="__codelineno-1-133" name="__codelineno-1-133" href="#__codelineno-1-133"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-1-134" name="__codelineno-1-134" href="#__codelineno-1-134"></a>
<a id="__codelineno-1-135" name="__codelineno-1-135" href="#__codelineno-1-135"></a><span class="w">        </span><span class="c1">// tìm chỉ số lớp lớn nhất bao bọc đoạn [l, r]</span>
<a id="__codelineno-1-136" name="__codelineno-1-136" href="#__codelineno-1-136"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">layer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">onLayer</span><span class="p">[</span><span class="n">clz</span><span class="p">[(</span><span class="n">l</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">base</span><span class="p">)</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">base</span><span class="p">)]];</span>
<a id="__codelineno-1-137" name="__codelineno-1-137" href="#__codelineno-1-137"></a><span class="w">        </span><span class="c1">// block size của các blocks trên layer này</span>
<a id="__codelineno-1-138" name="__codelineno-1-138" href="#__codelineno-1-138"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">bSzLog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">layers</span><span class="p">[</span><span class="n">layer</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-1-139" name="__codelineno-1-139" href="#__codelineno-1-139"></a><span class="w">        </span><span class="c1">// number of blocks trên layer này</span>
<a id="__codelineno-1-140" name="__codelineno-1-140" href="#__codelineno-1-140"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">bCntLog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">layers</span><span class="p">[</span><span class="n">layer</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-1-141" name="__codelineno-1-141" href="#__codelineno-1-141"></a><span class="w">        </span><span class="c1">// lBound = số phần tử nằm bên trái của block chứa l</span>
<a id="__codelineno-1-142" name="__codelineno-1-142" href="#__codelineno-1-142"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">lBound</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(((</span><span class="n">l</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">base</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">layers</span><span class="p">[</span><span class="n">layer</span><span class="p">])</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">layers</span><span class="p">[</span><span class="n">layer</span><span class="p">])</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">base</span><span class="p">;</span>
<a id="__codelineno-1-143" name="__codelineno-1-143" href="#__codelineno-1-143"></a><span class="w">        </span><span class="c1">// lBlock và rBlock là các block trái và phải ngoài cùng không chứa l và r</span>
<a id="__codelineno-1-144" name="__codelineno-1-144" href="#__codelineno-1-144"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">lBlock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">l</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lBound</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">bSzLog</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-1-145" name="__codelineno-1-145" href="#__codelineno-1-145"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">rBlock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">r</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lBound</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">bSzLog</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-1-146" name="__codelineno-1-146" href="#__codelineno-1-146"></a>
<a id="__codelineno-1-147" name="__codelineno-1-147" href="#__codelineno-1-147"></a><span class="w">        </span><span class="c1">// lấy đáp án trên block trái ngoài cùng</span>
<a id="__codelineno-1-148" name="__codelineno-1-148" href="#__codelineno-1-148"></a><span class="w">        </span><span class="n">SqrtTreeItem</span><span class="w"> </span><span class="n">ans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">suf</span><span class="p">[</span><span class="n">layer</span><span class="p">][</span><span class="n">l</span><span class="p">];</span>
<a id="__codelineno-1-149" name="__codelineno-1-149" href="#__codelineno-1-149"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lBlock</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">rBlock</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-150" name="__codelineno-1-150" href="#__codelineno-1-150"></a><span class="w">            </span><span class="n">SqrtTreeItem</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">layer</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-1-151" name="__codelineno-1-151" href="#__codelineno-1-151"></a><span class="w">                </span><span class="c1">// nếu nó nằm trên layer 0, ta truy vấn với &quot;index&quot;, vì nó chứa thông tin của tất cả các block của layer 0</span>
<a id="__codelineno-1-152" name="__codelineno-1-152" href="#__codelineno-1-152"></a><span class="w">                </span><span class="n">query</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lBlock</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rBlock</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">lg</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-1-153" name="__codelineno-1-153" href="#__codelineno-1-153"></a><span class="w">            </span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-1-154" name="__codelineno-1-154" href="#__codelineno-1-154"></a><span class="w">                </span><span class="c1">// nếu layer không là node gốc, ta dễ dàng dùng &quot;between&quot; để lấy kết quá</span>
<a id="__codelineno-1-155" name="__codelineno-1-155" href="#__codelineno-1-155"></a><span class="w">                </span><span class="n">between</span><span class="p">[</span><span class="n">layer</span><span class="mi">-1</span><span class="p">][</span><span class="n">betweenOffset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lBound</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">lBlock</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">bCntLog</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rBlock</span><span class="p">]</span>
<a id="__codelineno-1-156" name="__codelineno-1-156" href="#__codelineno-1-156"></a><span class="w">            </span><span class="p">);</span>
<a id="__codelineno-1-157" name="__codelineno-1-157" href="#__codelineno-1-157"></a><span class="w">            </span><span class="c1">// thêm đáp án của các block giữa vào đáp án cuối cùng</span>
<a id="__codelineno-1-158" name="__codelineno-1-158" href="#__codelineno-1-158"></a><span class="w">            </span><span class="n">ans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">op</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span><span class="w"> </span><span class="n">add</span><span class="p">);</span>
<a id="__codelineno-1-159" name="__codelineno-1-159" href="#__codelineno-1-159"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-1-160" name="__codelineno-1-160" href="#__codelineno-1-160"></a><span class="w">        </span><span class="c1">// lấy đáp án trên block phải ngoài cùng</span>
<a id="__codelineno-1-161" name="__codelineno-1-161" href="#__codelineno-1-161"></a><span class="w">        </span><span class="n">ans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">op</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span><span class="w"> </span><span class="n">pref</span><span class="p">[</span><span class="n">layer</span><span class="p">][</span><span class="n">r</span><span class="p">]);</span>
<a id="__codelineno-1-162" name="__codelineno-1-162" href="#__codelineno-1-162"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ans</span><span class="p">;</span>
<a id="__codelineno-1-163" name="__codelineno-1-163" href="#__codelineno-1-163"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-164" name="__codelineno-1-164" href="#__codelineno-1-164"></a>
<a id="__codelineno-1-165" name="__codelineno-1-165" href="#__codelineno-1-165"></a><span class="w">    </span><span class="kr">inline</span><span class="w"> </span><span class="n">SqrtTreeItem</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-166" name="__codelineno-1-166" href="#__codelineno-1-166"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">query</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-1-167" name="__codelineno-1-167" href="#__codelineno-1-167"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-168" name="__codelineno-1-168" href="#__codelineno-1-168"></a>
<a id="__codelineno-1-169" name="__codelineno-1-169" href="#__codelineno-1-169"></a><span class="w">    </span><span class="kr">inline</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">SqrtTreeItem</span><span class="w"> </span><span class="o">&amp;</span><span class="n">item</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-170" name="__codelineno-1-170" href="#__codelineno-1-170"></a><span class="w">        </span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">item</span><span class="p">;</span>
<a id="__codelineno-1-171" name="__codelineno-1-171" href="#__codelineno-1-171"></a><span class="w">        </span><span class="n">update</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-1-172" name="__codelineno-1-172" href="#__codelineno-1-172"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-173" name="__codelineno-1-173" href="#__codelineno-1-173"></a>
<a id="__codelineno-1-174" name="__codelineno-1-174" href="#__codelineno-1-174"></a><span class="w">    </span><span class="n">SqrtTree</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">SqrtTreeItem</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">n</span><span class="p">(</span><span class="n">SZ</span><span class="p">(</span><span class="n">a</span><span class="p">)),</span><span class="w"> </span><span class="n">lg</span><span class="p">(</span><span class="n">log2Up</span><span class="p">(</span><span class="n">n</span><span class="p">)),</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="w"> </span><span class="n">clz</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">lg</span><span class="p">),</span><span class="w"> </span><span class="n">onLayer</span><span class="p">(</span><span class="n">lg</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-175" name="__codelineno-1-175" href="#__codelineno-1-175"></a><span class="w">        </span><span class="c1">// n = kích thước mảng ban đầu</span>
<a id="__codelineno-1-176" name="__codelineno-1-176" href="#__codelineno-1-176"></a><span class="w">        </span><span class="c1">// lg = ceil(log2(n))</span>
<a id="__codelineno-1-177" name="__codelineno-1-177" href="#__codelineno-1-177"></a>
<a id="__codelineno-1-178" name="__codelineno-1-178" href="#__codelineno-1-178"></a><span class="w">        </span><span class="c1">// clz[i] = vị trí bit 1 nhỏ nhất</span>
<a id="__codelineno-1-179" name="__codelineno-1-179" href="#__codelineno-1-179"></a><span class="w">        </span><span class="n">clz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-1-180" name="__codelineno-1-180" href="#__codelineno-1-180"></a><span class="w">        </span><span class="n">FOR</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">SZ</span><span class="p">(</span><span class="n">clz</span><span class="p">)</span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="n">clz</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clz</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-1-181" name="__codelineno-1-181" href="#__codelineno-1-181"></a>
<a id="__codelineno-1-182" name="__codelineno-1-182" href="#__codelineno-1-182"></a><span class="w">        </span><span class="c1">// layers[i] là độ dài block ở layer i</span>
<a id="__codelineno-1-183" name="__codelineno-1-183" href="#__codelineno-1-183"></a><span class="w">        </span><span class="c1">// onLayer[i] = x nghĩa là nếu dộ dài block là 2^i thì nó nên nằm trên layer x</span>
<a id="__codelineno-1-184" name="__codelineno-1-184" href="#__codelineno-1-184"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">tlg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lg</span><span class="p">;</span>
<a id="__codelineno-1-185" name="__codelineno-1-185" href="#__codelineno-1-185"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">tlg</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-186" name="__codelineno-1-186" href="#__codelineno-1-186"></a><span class="w">            </span><span class="n">onLayer</span><span class="p">[</span><span class="n">tlg</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SZ</span><span class="p">(</span><span class="n">layers</span><span class="p">);</span>
<a id="__codelineno-1-187" name="__codelineno-1-187" href="#__codelineno-1-187"></a><span class="w">            </span><span class="n">layers</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tlg</span><span class="p">);</span>
<a id="__codelineno-1-188" name="__codelineno-1-188" href="#__codelineno-1-188"></a><span class="w">            </span><span class="c1">// sqrt(2^x) = 2^(x / 2)</span>
<a id="__codelineno-1-189" name="__codelineno-1-189" href="#__codelineno-1-189"></a><span class="w">            </span><span class="n">tlg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tlg</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-1-190" name="__codelineno-1-190" href="#__codelineno-1-190"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-1-191" name="__codelineno-1-191" href="#__codelineno-1-191"></a><span class="w">        </span><span class="n">FORE</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">lg</span><span class="mi">-1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">ckmax</span><span class="p">(</span><span class="n">onLayer</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">onLayer</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>
<a id="__codelineno-1-192" name="__codelineno-1-192" href="#__codelineno-1-192"></a>
<a id="__codelineno-1-193" name="__codelineno-1-193" href="#__codelineno-1-193"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">betweenLayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">SZ</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-1-194" name="__codelineno-1-194" href="#__codelineno-1-194"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">bSzLog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">lg</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-1-195" name="__codelineno-1-195" href="#__codelineno-1-195"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">bSz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">bSzLog</span><span class="p">);</span>
<a id="__codelineno-1-196" name="__codelineno-1-196" href="#__codelineno-1-196"></a><span class="w">        </span><span class="c1">// indexSz là số cảc block độ dài bSz, chia n phần tử ra thành chừng đó block</span>
<a id="__codelineno-1-197" name="__codelineno-1-197" href="#__codelineno-1-197"></a><span class="w">        </span><span class="c1">// nó đơn giản là ceilDiv(n, bSz)</span>
<a id="__codelineno-1-198" name="__codelineno-1-198" href="#__codelineno-1-198"></a><span class="w">        </span><span class="n">indexSz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">bSz</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">bSzLog</span><span class="p">;</span>
<a id="__codelineno-1-199" name="__codelineno-1-199" href="#__codelineno-1-199"></a>
<a id="__codelineno-1-200" name="__codelineno-1-200" href="#__codelineno-1-200"></a><span class="w">        </span><span class="n">v</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">indexSz</span><span class="p">);</span>
<a id="__codelineno-1-201" name="__codelineno-1-201" href="#__codelineno-1-201"></a><span class="w">        </span><span class="n">pref</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">layers</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">SqrtTreeItem</span><span class="o">&gt;</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">indexSz</span><span class="p">));</span>
<a id="__codelineno-1-202" name="__codelineno-1-202" href="#__codelineno-1-202"></a><span class="w">        </span><span class="n">suf</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">layers</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">SqrtTreeItem</span><span class="o">&gt;</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">indexSz</span><span class="p">));</span>
<a id="__codelineno-1-203" name="__codelineno-1-203" href="#__codelineno-1-203"></a><span class="w">        </span><span class="n">between</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">betweenLayers</span><span class="p">,</span><span class="w"> </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">SqrtTreeItem</span><span class="o">&gt;</span><span class="p">((</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">lg</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">bSz</span><span class="p">));</span>
<a id="__codelineno-1-204" name="__codelineno-1-204" href="#__codelineno-1-204"></a>
<a id="__codelineno-1-205" name="__codelineno-1-205" href="#__codelineno-1-205"></a><span class="w">        </span><span class="n">build</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-1-206" name="__codelineno-1-206" href="#__codelineno-1-206"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-207" name="__codelineno-1-207" href="#__codelineno-1-207"></a><span class="p">};</span>
</code></pre></div>
<h2 id="luyen-tap">Luyện tập</h2>
<table>
<thead>
<tr>
<th style="text-align: center;">Problem</th>
<th style="text-align: center;">Status</th>
<th style="text-align: center;">Submission</th>
<th style="text-align: center;">Code</th>
<th style="text-align: center;">Date</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><a href="https://www.codechef.com/problems/SEGPROD">Codechef - SEGPROD</a></td>
<td style="text-align: center;"><img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td style="text-align: center;"><a href="https://www.codechef.com/viewsolution/89329413">Submission</a></td>
<td style="text-align: center;"><a href="https://github.com/farmerboy95/CompetitiveProgramming/blob/master/Codechef/CODECHEF%20SEGPROD-SqrtTree.cpp">Code</a></td>
<td style="text-align: center;">14/02/2023</td>
</tr>
</tbody>
</table>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-custom">11/10/2023 (GMT+07)</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-custom">14/02/2023 (GMT+07)</span>
  </span>

    
    
      
  
  <span class="md-source-file__fact">
    <span class="md-icon" title="Contributors">
      
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 4a4 4 0 0 1 4 4 4 4 0 0 1-4 4 4 4 0 0 1-4-4 4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4Z"/></svg>
      
    </span>
    <nav>
      
        <a href="mailto:jerry.stone.manutd@gmail.com">farmerboy95</a>
    </nav>
  </span>

    
    
  </aside>


  







  <h2 id="__comments">Comments</h2>
  <!-- Insert generated snippet here -->
  <script src="https://giscus.app/client.js"
    data-repo="farmerboy95/CPBlogs"
    data-repo-id="R_kgDOIA7h_g"
    data-category="General"
    data-category-id="DIC_kwDOIA7h_s4CVvKI"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="bottom"
    data-theme="preferred_color_scheme"
    data-lang="en"
    crossorigin="anonymous"
    async>
  </script>
  <!-- Synchronize Giscus theme with palette -->
  <script>
    var giscus = document.querySelector("script[src*=giscus]")

    /* Set palette on initial load */
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
      var theme = palette.color.scheme === "slate" ? "dark" : "light"
      giscus.setAttribute("data-theme", theme) 
    }

    /* Register event handlers after documented loaded */
    document.addEventListener("DOMContentLoaded", function() {
      var ref = document.querySelector("[data-md-component=palette]")
      ref.addEventListener("change", function() {
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
          var theme = palette.color.scheme === "slate" ? "dark" : "light"

          /* Instruct Giscus to change theme */
          var frame = document.querySelector(".giscus-frame")
          frame.contentWindow.postMessage(
            { giscus: { setConfig: { theme } } },
            "https://giscus.app"
          )
        }
      })
    })
  </script>

                

  
    <div class="md-source-date">
      <small>
        Authors: <span class='git-page-authors git-authors'><a href='mailto:jerry.stone.manutd@gmail.com'>farmerboy95</a></span>
      </small>
    </div>
  

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 farmerboy
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/farmerboy95" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "navigation.top"], "search": "../../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
  
      <script src="../../../../assets/javascripts/bundle.e1c3ead8.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  <script
    data-name="BMC-Widget"
    data-cfasync="false" 
    src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" 
    data-id="farmerboy" 
    data-description="Support me on Buy me a coffee!" 
    data-message="" 
    data-color="#5F7FFF" 
    data-position="Right" 
    data-x_margin="18" 
    data-y_margin="18"
  ></script>

  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>